{{/*
Purpose: Notes listing page with year-based grouping

Features:
- Page title via page-title.html partial (hidden by default)
- Year headings for chronological organization
- Paginated notes list
- Draft filtering in production
- Pagination controls

Important Notes:
- Overrides theme default list.html for notes
- Date format: "Jan · 02" (month · day)
- Year headings inserted dynamically when year changes
- Pagination configured in hugo.toml (pagerSize)
*/}}

{{ define "main" }}
    <!-- Page Title (smart visibility: notes section listing hides title) -->
    {{ partial "page-title.html" . }}

    <section class="recent-notes">
        {{ $pages := .Pages }}
        {{ if not hugo.IsServer }}
        {{ $pages = where $pages "Draft" false }}
        {{ end }}
        {{ $paginator := .Paginate $pages }}
        {{ $lastYear := "" }}
        {{ range $paginator.Pages }}
            {{ $currentYear := .Date.Format "2006" }}
            {{ if ne $currentYear $lastYear }}
                <h2 class="section-label-medium">{{ $currentYear }}</h2>
                {{ $lastYear = $currentYear }}
            {{ end }}
            <article class="note-item">
                <a href="{{ .RelPermalink }}">
                    <time datetime="{{ .Date.Format "2006-01-02" }}" class="note-date">{{ .Date.Format "Jan · 02" }}</time>
                    <span class="note-title">{{ .Title }}</span>
                </a>
            </article>
        {{ end }}
    </section>

    {{ if or $paginator.HasPrev $paginator.HasNext }}
    <nav class="pagination">
        {{ if $paginator.HasPrev }}
        <a href="{{ $paginator.Prev.URL }}" class="pagination-prev"><span aria-hidden="true">←</span> Newer</a>
        {{ end }}
        {{ if $paginator.HasNext }}
        <a href="{{ $paginator.Next.URL }}" class="pagination-next"><span class="link-text">Older</span> <span aria-hidden="true">→</span></a>
        {{ end }}
    </nav>
    {{ end }}
{{ end }}
