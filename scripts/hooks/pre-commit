#!/bin/bash
# Block go.mod commits on master branch (theme updates should come via GitHub Actions)
# Feature/preview branches can update theme manually for testing

# Only block on master branch
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
if [ "$CURRENT_BRANCH" != "master" ]; then
    exit 0
fi

if git diff --cached --name-only | grep -q "^go.mod$"; then
    if git diff --cached go.mod | grep -q "tangerine-theme"; then
        echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
        echo "❌ ERROR: Do NOT manually commit go.mod theme updates!"
        echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
        echo ""
        echo "Theme updates must come via GitHub Actions workflow."
        echo ""
        echo "CORRECT WORKFLOW:"
        echo "  1. Push theme changes to tangerine-theme master"
        echo "  2. Run: gh workflow run auto-theme-update-pr.yml --repo shawnyeager/shawnyeager-notes"
        echo "  3. Wait for GitHub Actions to create the PR"
        echo "  4. Review deploy preview and merge"
        echo ""
        echo "This commit has been BLOCKED."
        echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
        exit 1
    fi
fi
